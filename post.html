<html>

<head>
    <title>Fake Checker</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="https://unpkg.com/feather-icons"></script>
</head>

<body id="page">



    <div class="header bg-header">
        <a href="index.html" class="header-text"><img class="header-logo" src="fclogo.svg"></a>
        <input type="search" class="search" value="Search" onfocus="this.value=''" onblur="this.value='Search'"></input>
    </div>

    <div id="alert" class="spaced"></div>

    <!-- <center>
        <div class="status-tile fabricated">
            <i class="icon20" data-feather="info"></i><span id="verification-status">False</span>
        </div>

        <div onclick="voteTrue()" class="button green"><i class="icon20" data-feather="thumbs-up"></i>True</div>
        <div onclick="voteFalse()" class="button red"><i class="icon20" data-feather="thumbs-down"></i>False</div>
    </center> -->

    <div class="claim spaced">
        <span onclick="this.contentEditable = 'true'; this.classList.add('comment-box')" onblur="setSummary();this.classList.remove('comment-box') " id="post-summary"></span>
    </div>

    <div class="reported">
        Reported <span id="report-count">0</span> times since <span id="first-report">1 January 2020</span>.
    </div>


    <div class="post-container">
        <p id="post-text" class="limited">...</p>

        <a id="expandPost" onclick="expandPost()" class="button noselect"><i class="icon20" data-feather="maximize-2"></i><span id="readMoreText">Read more</span></a>
        <!-- <a id="showVariants" onclick="" class="button noselect"><i class="icon20" data-feather="layers"></i>3 Variants</a> -->

    </div>

    <h3 class="spaced">Do you think this message is fake?</h3>
    <p class="spaced">People like you help power Fakechecker!</p>

    <div class="vote-option-container">

        <div onclick="voteTrue()" class=vote-option id="vote-true">
            <img id="true-svg" class="vote-icon" src="img/true.svg">
            <div class="vote-text">
                <p class="vote-type">True</p>
                <span id="vote-true-num" class="num-votes">0 votes</span>
            </div>

        </div>

        <div onclick="voteMisleading()" class=vote-option id="vote-misleading">
            <img id="misleading-svg" class="vote-icon" src="img/misleading.svg">
            <div class="vote-text">
                <p class="vote-type">Misleading</p>
                <span id="vote-misleading-num" class="num-votes">0 votes</span>
            </div>
        </div>

        <div onclick="votePartlyFake()" class=vote-option id="vote-partlyfake">
            <img id="partlyfake-svg" class="vote-icon" src="img/dontknow.svg">
            <div class="vote-text">
                <p class="vote-type">Partly fake</p>
                <span id="vote-partlyfake-num" class="num-votes">0 votes</span>
            </div>
        </div>

        <div onclick="voteFake()" class=vote-option id="vote-fake">
            <img id="fake-svg" class="vote-icon" src="img/false.svg">
            <div class="vote-text">
                <p class="vote-type">Fake</p>
                <span id="vote-fake-num" class="num-votes">0 votes</span>
            </div>
        </div>

    </div>




    <div id="improve" class="spaced">
        <h3>Edit Factcheck</h3>
        <form action="">
            <p class="no-top-margin">Fact-checks should explain why the information in the post is true or false in simple terms. You can provide a link to other resources like fact-checking sites, news sites, or published research for further reading. </p>

            <div class="improve-label">Factcheck</div>
            <textarea class="comment-box" placeholder="Why is this information true or false?" name="textinput-factcheck" id="edit-factcheck" cols="30" rows="8"></textarea><br>

            <div class="improve-label">Source Link</div>
            <input class="comment-box" placeholder="Link to a news website or other source." type="text" name="textinput-factcheck-link" id="edit-factcheck-link"><br>

            <div class="improve-label">Source Article Title</div>
            <input class="comment-box" placeholder="Title of the article" type="text" name="textinput-factcheck-articletitle" id="edit-factcheck-title"><br>

            <div class="improve-label">Source Name</div>
            <input class="comment-box" placeholder="Name of the source" type="text" name="textinput-factcheck-sourcename" id="edit-factcheck-sourcename"><br>
        </form>

        <a id="doneImproveButton" onclick="submitAndHideImprove()" class="button noselect"><i class="icon20" data-feather="check"></i>Submit</a>
        <a id="cancelImproveButton" onclick="hideImprove()" class="button noselect"><i class="icon20" data-feather="x"></i>Cancel</a>
    </div>

    <div id="factcheckUI">
        <h3 class="spaced">Factcheck</h3>

        <p id="post-factcheck" class="spaced"></p>


        <textarea id="response">

  </textarea>


        <a id="link" class="alert weblink">
            <img class="icon20" src="img/web.png">
            <span id="link-title">...</span>
            <div class="smaller opacity50 smallcaps"><span id="link-source">...</span><i class="icon16" data-feather="chevron-right"></i></div>
        </a>



        <div class="spaced">
            <a id="whatsappButton" class="button noselect" href="whatsapp://send?text=*This message is fake!* There is no evidence of a NASA SD13 wave detector, there's no confirmation from NASA to show that the 5PM clapping did anything to show that the Coronavirus is retreating in India. The number of daily Coronavirus cases are only rising in India, and are expected to rise sharply in the coming days. All of us here in India need to exercise sound personal judgement and stay safe indoors as much as possible. Read more at www.gyanl.com/fakechecker/nasa-covid"
                data-action="share/whatsapp/share"><i class="icon20" data-feather="share-2"></i>Share on WhatsApp</a>

            <a id="copyButton" onclick="copyText()" class="button noselect"><i class="icon20" data-feather="copy"></i><span id="copyButtonText">Copy</span></a>

            <a id="editFactcheckButton" onclick="showImprove()" class="button noselect"><i class="icon20" data-feather="edit"></i>Edit</a>
            <a id="addFactcheckButton" onclick="showImprove()" class="button noselect"><i class="icon20" data-feather="edit"></i>Add Factcheck</a>

            <!-- <a id="revisionHistoryButton" onclick="" class="button noselect"><i class="icon20" data-feather="clock"></i>History</a> -->

        </div>
    </div>

    <div class="comment-section">
        <h3 class="spaced">Comments</h3>
        <div id="comments-container">

        </div>


        <form class="spaced">
            <p></p>
            <div class="improve-label">Post a comment</div>
            <textarea placeholder="Comment..." id="commentBox" class="comment-box" rows=4></textarea><br>

            <div class="improve-label">Your Name</div>
            <input class="comment-box" type="text" name="textinput-username" id="commentBox-author" value="guest"><br>
            <a onclick="submitComment()" class="button"><i class="icon20" data-feather="send"></i>Post</a>


        </form>


    </div>

    <footer>
        <img class="header-logo" src="fclogo-white.svg">
        <p><a href="about.html">About Fakechecker</a></p>
        <p><a href="about.html">Community Guidelines</a></p>
        <p><a href="about.html">Rules for editing</a></p>
    </footer>

    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/7.15.1/firebase-app.js"></script>

    <!-- TODO: Add SDKs for Firebase products that you want to use
       https://firebase.google.com/docs/web/setup#available-libraries -->
    <script src="https://www.gstatic.com/firebasejs/7.15.1/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.15.1/firebase-database.js"></script>

    <script>
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyD30YcwE_5f3rO2QRC25kQ5rEbeWz5zj9Y",
            authDomain: "fakechecker-bf9fb.firebaseapp.com",
            databaseURL: "https://fakechecker-bf9fb.firebaseio.com",
            projectId: "fakechecker-bf9fb",
            storageBucket: "fakechecker-bf9fb.appspot.com",
            messagingSenderId: "76875907987",
            appId: "1:76875907987:web:76fc66053bedbf98e65e66",
            measurementId: "G-80X57EVT25"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        firebase.analytics();

        var database = firebase.database();

        var currentPostId = location.search.substring(1);
        console.log(currentPostId);




        var numComments = 0;
        var numTrue = 1;
        var numMisleading = 2;
        var numPartlyFake = 3;
        var numFake = 4;

        function setSummary() {
            if (document.getElementById("post-summary").innerHTML != 'Click to add a summary.') {

                firebase.database().ref('posts/' + currentPostId).update({

                    post_summary: document.getElementById("post-summary").innerHTML

                }, function(error) {
                    if (error) {
                        console.log("Summary update failed...");
                    } else {
                        console.log("Summary improved :)");
                    }
                });
                hideImprove();
            }
        }


        const ref = firebase.database().ref('posts/' + currentPostId);
        ref.on('value', (snapshot) => {

            function fillPage() {
                if (snapshot.val().post_summary) {
                    document.getElementById("post-summary").innerHTML = snapshot.val().post_summary;
                } else {
                    document.getElementById("post-summary").innerHTML = "Click to add a summary."
                }

                document.getElementById("report-count").innerHTML = snapshot.val().report_count;
                document.getElementById("first-report").innerHTML = snapshot.val().first_report;
                document.getElementById("post-text").innerHTML = snapshot.val().post_text;

                if (snapshot.val().vote_true) {
                    numTrue = snapshot.val().vote_true;
                    console.log("Some True Votes");
                } else {
                    numTrue = 0;
                    console.log("No True Votes");
                }

                if (snapshot.val().vote_misleading) {
                    numMisleading = snapshot.val().vote_misleading;
                } else {
                    numMisleading = 0;
                    console.log("No Misleading Votes");
                }

                if (snapshot.val().vote_partlyfake) {
                    numPartlyFake = snapshot.val().vote_partlyfake;
                } else {
                    numPartlyFake = 0;
                }

                if (snapshot.val().vote_fake) {
                    numFake = snapshot.val().vote_fake;
                } else {
                    numFake = 0;
                }

                document.getElementById("vote-true-num").innerHTML = numTrue + " votes";
                document.getElementById("vote-misleading-num").innerHTML = numMisleading + " votes";
                document.getElementById("vote-partlyfake-num").innerHTML = numPartlyFake + " votes";
                document.getElementById("vote-fake-num").innerHTML = numFake + " votes";


                if (snapshot.val().post_factcheck) {
                    document.getElementById("post-factcheck").innerHTML = snapshot.val().post_factcheck;
                    document.getElementById("edit-factcheck").value = snapshot.val().post_factcheck;
                    document.getElementById("addFactcheckButton").style.display = "none";
                    document.getElementById("editFactcheckButton").style.display = "inline-block";
                    document.getElementById("copyButton").style.display = "inline-block";
                    document.getElementById("whatsappButton").style.display = "inline-block";
                } else {
                    document.getElementById("post-factcheck").innerHTML = "There is no fact-check available right now."
                    document.getElementById("alert").style.display = "block";
                    document.getElementById("alert").innerHTML = "<div class='improve-label'>No factcheck available.</div>We could not find any matches, so a new page has been created."
                    document.getElementById("addFactcheckButton").style.display = "inline-block";
                    document.getElementById("editFactcheckButton").style.display = "none";
                    document.getElementById("copyButton").style.display = "none";
                    document.getElementById("whatsappButton").style.display = "none";
                    document.getElementById("whatsappButton").href = "whatsapp://send?text=" + snapshot.val().post_factcheck;

                }

                document.getElementById("link-title").innerHTML = snapshot.val().link_title;
                document.getElementById("link-source").innerHTML = snapshot.val().link_source;
                // document.getElementById("link-favicon").innerHTML = snapshot.val().link_favicon;

                // Edit area
                if (snapshot.val().link) {
                    document.getElementById("edit-factcheck-link").value = snapshot.val().link;
                    document.getElementById("link").href = snapshot.val().link;
                } else {
                    document.getElementById("link").style.display = 'none';
                }

                if (snapshot.val().link_title) {
                    document.getElementById("edit-factcheck-title").value = snapshot.val().link_title;
                }

                if (snapshot.val().link_source) {
                    document.getElementById("edit-factcheck-sourcename").value = snapshot.val().link_source;
                }

                document.getElementById("response").innerHTML = snapshot.val().post_factcheck + "\nRead more at www.gyanl.com/fakechecker/post.html?" + currentPostId;

                document.getElementById("page").style.opacity = "1";
            }

            fillPage();
            getStatus();
        });

        function voteTrue() {

            var votes = numTrue + 1;

            firebase.database().ref('posts/' + currentPostId).update({
                vote_true: votes

            }, function(error) {
                if (error) {
                    console.log("Failed to vote True...");
                } else {
                    console.log("Voted True :)");
                }
            });

            document.getElementById("true-svg").src = "img/true-color.svg";
        }

        function voteMisleading() {

            var votes = numMisleading + 1;

            firebase.database().ref('posts/' + currentPostId).update({
                vote_misleading: votes

            }, function(error) {
                if (error) {
                    console.log("Failed to vote Misleading...");
                } else {
                    console.log("Voted Misleading :)");
                }
            });
            document.getElementById("misleading-svg").src = "img/misleading-color.svg";

        }

        function votePartlyFake() {

            var votes = numPartlyFake + 1;

            firebase.database().ref('posts/' + currentPostId).update({
                vote_partlyfake: votes

            }, function(error) {
                if (error) {
                    console.log("Failed to vote Partly Fake...");
                } else {
                    console.log("Voted Partly Fake :)");
                }
            });
            document.getElementById("partlyfake-svg").src = "img/dontknow-color.svg";

        }

        function voteFake() {

            var votes = numFake + 1;

            firebase.database().ref('posts/' + currentPostId).update({
                vote_fake: votes

            }, function(error) {
                if (error) {
                    console.log("Failed to vote Fake...");
                } else {
                    console.log("Voted Fake :)");
                }
            });
            document.getElementById("fake-svg").src = "img/false-color.svg";


        }

        function showImprove() {
            document.getElementById("improve").style.display = "block";
            document.getElementById("factcheckUI").style.display = "none";
        }

        function hideImprove() {
            document.getElementById("improve").style.display = "none";
            document.getElementById("factcheckUI").style.display = "block";
        }

        function submitAndHideImprove() {

            firebase.database().ref('posts/' + currentPostId).update({
                post_factcheck: document.getElementById("edit-factcheck").value,
                link: document.getElementById("edit-factcheck-link").value,
                link_title: document.getElementById("edit-factcheck-title").value,
                link_source: document.getElementById("edit-factcheck-sourcename").value

            }, function(error) {
                if (error) {
                    console.log("Improve failed...");
                } else {
                    console.log("Improved :)");
                }
            });
            hideImprove();
        }



        const cmts = firebase.database().ref('comments/' + currentPostId);
        cmts.on('value', (snapshot) => {

            function fillComments() {
                var comments = snapshot.val();
                numComments = comments.length;
                document.getElementById("comments-container").innerHTML = "";

                for (var i = 0; i < comments.length; i++)
                    document.getElementById("comments-container").innerHTML += "<div class='comment-container spaced'>" + comments[i].comment + "<div class='comment-metadata'>" + comments[i].author + " â€¢ " + comments[i].timestamp + "</div></div>";
            }

            fillComments();
        });

        function submitComment() {

            var today = new Date();
            var date = today.getFullYear() + '-' + (today.getMonth() + 1) + '-' + today.getDate();
            var time = today.getHours() + ":" + today.getMinutes() + ":" + today.getSeconds();
            var dateTime = date + ' ' + time;

            firebase.database().ref('comments/' + currentPostId + '/' + numComments).set({
                comment: document.getElementById("commentBox").value,
                author: document.getElementById("commentBox-author").value,
                timestamp: dateTime

            }, function(error) {
                if (error) {
                    console.log("Comment failed...");
                } else {
                    console.log("Commented :)");
                }
            });

            document.getElementById("commentBox").value = "Comment...";
        }
    </script>


    <script type="text/javascript" src="script.js"></script>
</body>

</html>